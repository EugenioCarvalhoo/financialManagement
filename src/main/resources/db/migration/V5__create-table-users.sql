CREATE TABLE "tenants" (
	"id" BIGSERIAL,
	"name" VARCHAR(255) NOT NULL,
	"domain" VARCHAR(255) NOT NULL,
	"bussiness_name" VARCHAR(255) NOT NULL,
	"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY("id")
);


CREATE TABLE "ref_codes" (
	"id" BIGSERIAL,
	"type" VARCHAR(50) NOT NULL,
	"code" VARCHAR(50) NOT NULL,
	"name" VARCHAR(100) NOT NULL,
	"description" VARCHAR(255),
	"active_flag" BOOLEAN NOT NULL DEFAULT true,
	"ref_codes_required" BOOLEAN NOT NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"tenant_id" BIGINT,
	PRIMARY KEY("id")
);


CREATE TABLE "receive" (
	"id" BIGSERIAL,
	"description" VARCHAR(255),
	"category" VARCHAR(255) NOT NULL,
	"amount" NUMERIC(15, 2) NOT NULL,
	"entry_date" DATE NOT NULL,
	"order_quantity" INTEGER NOT NULL,
	"status" VARCHAR(255) NOT NULL,
	"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"tenant_id" BIGINT NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "expense" (
	"id" BIGSERIAL,
	"description" VARCHAR(255),
	"category" VARCHAR NOT NULL,
	"amount" NUMERIC(15, 2) NOT NULL,
	"due_date" DATE NOT NULL,
	"payment_type" VARCHAR(255) NOT NULL,
	"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"tenant_id" BIGINT NOT NULL,
	"status" VARCHAR(255) NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "projection" (
	"id" BIGSERIAL,
	"category_input" VARCHAR,
	"category_output" VARCHAR,
	"due_date" DATE NOT NULL,
	"due_days" INTEGER,
	"config_date" DATE NOT NULL,
	"active_flag" BOOLEAN DEFAULT true,
	"created_at" TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
	"tenant_id" BIGINT,
	PRIMARY KEY("id")
);


CREATE TABLE "users" (
	"id" BIGSERIAL,
	"last_name" VARCHAR(100) NOT NULL,
	"first_name" VARCHAR(100) NOT NULL,
	"email" VARCHAR(150),
	"login" VARCHAR(150),
	"password" VARCHAR(255) NOT NULL,
	"temporary_password" VARCHAR(255),
	"role" VARCHAR(10) NOT NULL DEFAULT 'USER',
	"active_flag" BOOLEAN NOT NULL DEFAULT true,
	"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"tenant_id" BIGINT NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "order_canceled" (
	"id" BIGSERIAL,
	"amount" INTEGER NOT NULL,
	"order_canceled_date" DATE NOT NULL,
	"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"tenant_id" BIGSERIAL NOT NULL,
	PRIMARY KEY("id")
);


CREATE TABLE "receive_item" (
	"id" INTEGER NOT NULL UNIQUE GENERATED BY DEFAULT AS IDENTITY,
	"payment_type" VARCHAR(255) NOT NULL,
	"amount" NUMERIC(15, 2) NOT NULL,
	"receive_id" BIGSERIAL,
	"created_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	"updated_at" TIMESTAMPTZ NOT NULL DEFAULT CURRENT_TIMESTAMP,
	PRIMARY KEY("id")
);


ALTER TABLE "receive"
ADD FOREIGN KEY("tenant_id") REFERENCES "tenants"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "expense"
ADD FOREIGN KEY("tenant_id") REFERENCES "tenants"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "projection"
ADD FOREIGN KEY("tenant_id") REFERENCES "tenants"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "users"
ADD FOREIGN KEY("tenant_id") REFERENCES "tenants"("id")
ON UPDATE NO ACTION ON DELETE CASCADE;
ALTER TABLE "order_canceled"
ADD FOREIGN KEY("tenant_id") REFERENCES "tenants"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "receive_item"
ADD FOREIGN KEY("receive_id") REFERENCES "receive"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;
ALTER TABLE "ref_codes"
ADD FOREIGN KEY("tenant_id") REFERENCES "tenants"("id")
ON UPDATE NO ACTION ON DELETE NO ACTION;